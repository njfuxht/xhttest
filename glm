Application::Application()
{
	// Get screen resolution for fullscreen
	int window_width = GetSystemMetrics(SM_CXSCREEN);
	int window_height = GetSystemMetrics(SM_CYSCREEN);

	// Create window with fullscreen enabled
	m_Window = std::make_unique<Window>(this);
	m_WindowCreated = m_Window->Create(m_ApplicationTitle, window_width, window_height, true);

	// Create renderer
	m_Renderer = std::make_unique<Renderer>(this);
	m_Renderer->Create();

	// Create shader
	m_Shader = std::make_unique<Shader>(m_Renderer.get());
	m_Shader->Load();

	// Create camera
	m_Camera = std::make_unique<Camera>(window_width, window_height);
}



window
bool Window::Create(const std::string& title, int width, int height, bool fullscreen)
{
	HINSTANCE hInstance = GetModuleHandle(NULL);
	std::wstring window_name = ConvertToWString(title);

	// Setup window class
	WNDCLASS wc = {};
	wc.style = CS_VREDRAW | CS_HREDRAW;
	wc.lpfnWndProc = ::MainWndProc;
	wc.hInstance = hInstance;
	wc.hIcon = LoadIcon(0, IDI_APPLICATION);
	wc.hCursor = LoadCursor(0, IDC_ARROW);
	wc.lpszClassName = window_name.c_str();

	if (!RegisterClass(&wc))
	{
		MessageBox(NULL, L"RegisterClass Failed", L"Error", MB_OK);
		throw std::exception();
	}

	// Create window
	DWORD window_style = WS_OVERLAPPEDWINDOW;
	int window_x = CW_USEDEFAULT;
	int window_y = CW_USEDEFAULT;

	// For fullscreen, use popup style and position at (0, 0)
	if (fullscreen)
	{
		window_style = WS_POPUP;
		window_x = 0;
		window_y = 0;
	}

	m_Hwnd = CreateWindow(wc.lpszClassName, window_name.c_str(), window_style, window_x, window_y, width, height, NULL, NULL, hInstance, this);
	if (m_Hwnd == NULL)
	{
		MessageBox(NULL, L"CreateWindow Failed", L"Error", MB_OK);
		throw std::exception();
	}

	// For fullscreen, set window to cover entire screen
	if (fullscreen)
	{
		SetWindowPos(m_Hwnd, HWND_TOP, 0, 0, width, height, SWP_FRAMECHANGED | SWP_SHOWWINDOW);
	}

	// Show window
	int cmd_show = (fullscreen ? SW_MAXIMIZE : SW_SHOWNORMAL);
	ShowWindow(m_Hwnd, cmd_show);

	return true;
}
